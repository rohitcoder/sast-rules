rules:
- id: path-traversal-open__umnri
  languages:
  - python
  message: Found request data in a call to 'open'.  Ensure the request data is validated
    or sanitized,  otherwise it could result in path traversal attacks and  therefore
    sensitive data being leaked. To mitigate, consider using os.path.abspath or os.path.realpath
    or the pathlib library.
  metadata:
    category: security
    confidence: MEDIUM
    cwe:
    - 'CWE-22: Improper Limitation of a Pathname to a Restricted Directory (''Path
      Traversal'')'
    cwe2021-top25: true
    cwe2022-top25: true
    impact: MEDIUM
    likelihood: MEDIUM
    owasp:
    - A05:2017 - Broken Access Control
    - A01:2021 - Broken Access Control
    references:
    - https://owasp.org/www-community/attacks/Path_Traversal
    subcategory:
    - vuln
    technology:
    - django
  patterns:
  - pattern-inside: "def $FUNC(...):\n  ...\n"
  - pattern-either:
    - pattern: open(..., request.$W.get(...), ...)
    - pattern: open(..., $S.format(..., request.$W.get(...), ...), ...)
    - pattern: open(..., $S % request.$W.get(...), ...)
    - pattern: open(..., f"...{request.$W.get(...)}...", ...)
    - pattern: '$DATA = request.$W.get(...)

        ...

        open(..., $DATA, ...)

        '
    - pattern: '$DATA = request.$W.get(...)

        ...

        $INTERM = $DATA

        ...

        open(..., $INTERM, ...)

        '
    - pattern: "$DATA = request.$W.get(...)\n...\n$INTERM = $DATA\n...\nwith open(...,\
        \ $INTERM, ...) as $FD:\n  ...\n"
    - pattern: '$DATA = request.$W.get(...)

        ...

        open(..., $STR.format(..., $DATA, ...), ...)

        '
    - pattern: '$DATA = request.$W.get(...)

        ...

        $INTERM = $STR.format(..., $DATA, ...)

        ...

        open(..., $INTERM, ...)

        '
    - pattern: "$DATA = request.$W.get(...)\n...\n$INTERM = $STR.format(..., $DATA,\
        \ ...)\n...\nwith open(..., $INTERM, ...) as $FD:\n  ...\n"
    - pattern: '$DATA = request.$W.get(...)

        ...

        open(..., $STR % $DATA, ...)

        '
    - pattern: '$DATA = request.$W.get(...)

        ...

        $INTERM = $STR % $DATA

        ...

        open(..., $INTERM, ...)

        '
    - pattern: "$DATA = request.$W.get(...)\n...\n$INTERM = $STR % $DATA\n...\nwith\
        \ open(..., $INTERM, ...) as $FD:\n  ...\n"
    - pattern: '$DATA = request.$W.get(...)

        ...

        open(..., f"...{$DATA}...", ...)

        '
    - pattern: '$DATA = request.$W.get(...)

        ...

        $INTERM = f"...{$DATA}..."

        ...

        open(..., $INTERM, ...)

        '
    - pattern: "$DATA = request.$W.get(...)\n...\n$INTERM = f\"...{$DATA}...\"\n...\n\
        with open(..., $INTERM, ...) as $FD:\n  ...\n"
    - pattern: '$DATA = request.$W.get(...)

        ...

        open(..., $STR + $DATA, ...)

        '
    - pattern: '$DATA = request.$W.get(...)

        ...

        $INTERM = $STR + $DATA

        ...

        open(..., $INTERM, ...)

        '
    - pattern: "$DATA = request.$W.get(...)\n...\n$INTERM = $STR + $DATA\n...\nwith\
        \ open(..., $INTERM, ...) as $FD:\n  ...\n"
    - pattern: $A = open(..., request.$W.get(...), ...)
    - pattern: $A = open(..., $S.format(..., request.$W.get(...), ...), ...)
    - pattern: $A = open(..., $S % request.$W.get(...), ...)
    - pattern: $A = open(..., f"...{request.$W.get(...)}...", ...)
    - pattern: return open(..., request.$W.get(...), ...)
    - pattern: return open(..., $S.format(..., request.$W.get(...), ...), ...)
    - pattern: return open(..., $S % request.$W.get(...), ...)
    - pattern: return open(..., f"...{request.$W.get(...)}...", ...)
    - pattern: "$DATA = request.$W.get(...)\n...\nwith open(..., $DATA, ...) as $FD:\n\
        \  ...\n"
    - pattern: open(..., request.$W(...), ...)
    - pattern: open(..., $S.format(..., request.$W(...), ...), ...)
    - pattern: open(..., $S % request.$W(...), ...)
    - pattern: open(..., f"...{request.$W(...)}...", ...)
    - pattern: '$DATA = request.$W(...)

        ...

        open(..., $DATA, ...)

        '
    - pattern: '$DATA = request.$W(...)

        ...

        $INTERM = $DATA

        ...

        open(..., $INTERM, ...)

        '
    - pattern: "$DATA = request.$W(...)\n...\n$INTERM = $DATA\n...\nwith open(...,\
        \ $INTERM, ...) as $FD:\n  ...\n"
    - pattern: '$DATA = request.$W(...)

        ...

        open(..., $STR.format(..., $DATA, ...), ...)

        '
    - pattern: '$DATA = request.$W(...)

        ...

        $INTERM = $STR.format(..., $DATA, ...)

        ...

        open(..., $INTERM, ...)

        '
    - pattern: "$DATA = request.$W(...)\n...\n$INTERM = $STR.format(..., $DATA, ...)\n\
        ...\nwith open(..., $INTERM, ...) as $FD:\n  ...\n"
    - pattern: '$DATA = request.$W(...)

        ...

        open(..., $STR % $DATA, ...)

        '
    - pattern: '$DATA = request.$W(...)

        ...

        $INTERM = $STR % $DATA

        ...

        open(..., $INTERM, ...)

        '
    - pattern: "$DATA = request.$W(...)\n...\n$INTERM = $STR % $DATA\n...\nwith open(...,\
        \ $INTERM, ...) as $FD:\n  ...\n"
    - pattern: '$DATA = request.$W(...)

        ...

        open(..., f"...{$DATA}...", ...)

        '
    - pattern: '$DATA = request.$W(...)

        ...

        $INTERM = f"...{$DATA}..."

        ...

        open(..., $INTERM, ...)

        '
    - pattern: "$DATA = request.$W(...)\n...\n$INTERM = f\"...{$DATA}...\"\n...\n\
        with open(..., $INTERM, ...) as $FD:\n  ...\n"
    - pattern: '$DATA = request.$W(...)

        ...

        open(..., $STR + $DATA, ...)

        '
    - pattern: '$DATA = request.$W(...)

        ...

        $INTERM = $STR + $DATA

        ...

        open(..., $INTERM, ...)

        '
    - pattern: "$DATA = request.$W(...)\n...\n$INTERM = $STR + $DATA\n...\nwith open(...,\
        \ $INTERM, ...) as $FD:\n  ...\n"
    - pattern: $A = open(..., request.$W(...), ...)
    - pattern: $A = open(..., $S.format(..., request.$W(...), ...), ...)
    - pattern: $A = open(..., $S % request.$W(...), ...)
    - pattern: $A = open(..., f"...{request.$W(...)}...", ...)
    - pattern: return open(..., request.$W(...), ...)
    - pattern: return open(..., $S.format(..., request.$W(...), ...), ...)
    - pattern: return open(..., $S % request.$W(...), ...)
    - pattern: return open(..., f"...{request.$W(...)}...", ...)
    - pattern: "$DATA = request.$W(...)\n...\nwith open(..., $DATA, ...) as $FD:\n\
        \  ...\n"
    - pattern: open(..., request.$W[...], ...)
    - pattern: open(..., $S.format(..., request.$W[...], ...), ...)
    - pattern: open(..., $S % request.$W[...], ...)
    - pattern: open(..., f"...{request.$W[...]}...", ...)
    - pattern: '$DATA = request.$W[...]

        ...

        open(..., $DATA, ...)

        '
    - pattern: '$DATA = request.$W[...]

        ...

        $INTERM = $DATA

        ...

        open(..., $INTERM, ...)

        '
    - pattern: "$DATA = request.$W[...]\n...\n$INTERM = $DATA\n...\nwith open(...,\
        \ $INTERM, ...) as $FD:\n  ...\n"
    - pattern: '$DATA = request.$W[...]

        ...

        open(..., $STR.format(..., $DATA, ...), ...)

        '
    - pattern: '$DATA = request.$W[...]

        ...

        $INTERM = $STR.format(..., $DATA, ...)

        ...

        open(..., $INTERM, ...)

        '
    - pattern: "$DATA = request.$W[...]\n...\n$INTERM = $STR.format(..., $DATA, ...)\n\
        ...\nwith open(..., $INTERM, ...) as $FD:\n  ...\n"
    - pattern: '$DATA = request.$W[...]

        ...

        open(..., $STR % $DATA, ...)

        '
    - pattern: '$DATA = request.$W[...]

        ...

        $INTERM = $STR % $DATA

        ...

        open(..., $INTERM, ...)

        '
    - pattern: "$DATA = request.$W[...]\n...\n$INTERM = $STR % $DATA\n...\nwith open(...,\
        \ $INTERM, ...) as $FD:\n  ...\n"
    - pattern: '$DATA = request.$W[...]

        ...

        open(..., f"...{$DATA}...", ...)

        '
    - pattern: '$DATA = request.$W[...]

        ...

        $INTERM = f"...{$DATA}..."

        ...

        open(..., $INTERM, ...)

        '
    - pattern: "$DATA = request.$W[...]\n...\n$INTERM = f\"...{$DATA}...\"\n...\n\
        with open(..., $INTERM, ...) as $FD:\n  ...\n"
    - pattern: '$DATA = request.$W[...]

        ...

        open(..., $STR + $DATA, ...)

        '
    - pattern: '$DATA = request.$W[...]

        ...

        $INTERM = $STR + $DATA

        ...

        open(..., $INTERM, ...)

        '
    - pattern: "$DATA = request.$W[...]\n...\n$INTERM = $STR + $DATA\n...\nwith open(...,\
        \ $INTERM, ...) as $FD:\n  ...\n"
    - pattern: $A = open(..., request.$W[...], ...)
    - pattern: $A = open(..., $S.format(..., request.$W[...], ...), ...)
    - pattern: $A = open(..., $S % request.$W[...], ...)
    - pattern: $A = open(..., f"...{request.$W[...]}...", ...)
    - pattern: return open(..., request.$W[...], ...)
    - pattern: return open(..., $S.format(..., request.$W[...], ...), ...)
    - pattern: return open(..., $S % request.$W[...], ...)
    - pattern: return open(..., f"...{request.$W[...]}...", ...)
    - pattern: "$DATA = request.$W[...]\n...\nwith open(..., $DATA, ...) as $FD:\n\
        \  ...\n"
    - pattern: open(..., request.$W, ...)
    - pattern: open(..., $S.format(..., request.$W, ...), ...)
    - pattern: open(..., $S % request.$W, ...)
    - pattern: open(..., f"...{request.$W}...", ...)
    - pattern: '$DATA = request.$W

        ...

        open(..., $DATA, ...)

        '
    - pattern: '$DATA = request.$W

        ...

        $INTERM = $DATA

        ...

        open(..., $INTERM, ...)

        '
    - pattern: "$DATA = request.$W\n...\n$INTERM = $DATA\n...\nwith open(..., $INTERM,\
        \ ...) as $FD:\n  ...\n"
    - pattern: '$DATA = request.$W

        ...

        open(..., $STR.format(..., $DATA, ...), ...)

        '
    - pattern: '$DATA = request.$W

        ...

        $INTERM = $STR.format(..., $DATA, ...)

        ...

        open(..., $INTERM, ...)

        '
    - pattern: "$DATA = request.$W\n...\n$INTERM = $STR.format(..., $DATA, ...)\n\
        ...\nwith open(..., $INTERM, ...) as $FD:\n  ...\n"
    - pattern: '$DATA = request.$W

        ...

        open(..., $STR % $DATA, ...)

        '
    - pattern: '$DATA = request.$W

        ...

        $INTERM = $STR % $DATA

        ...

        open(..., $INTERM, ...)

        '
    - pattern: "$DATA = request.$W\n...\n$INTERM = $STR % $DATA\n...\nwith open(...,\
        \ $INTERM, ...) as $FD:\n  ...\n"
    - pattern: '$DATA = request.$W

        ...

        open(..., f"...{$DATA}...", ...)

        '
    - pattern: '$DATA = request.$W

        ...

        $INTERM = f"...{$DATA}..."

        ...

        open(..., $INTERM, ...)

        '
    - pattern: "$DATA = request.$W\n...\n$INTERM = f\"...{$DATA}...\"\n...\nwith open(...,\
        \ $INTERM, ...) as $FD:\n  ...\n"
    - pattern: '$DATA = request.$W

        ...

        open(..., $STR + $DATA, ...)

        '
    - pattern: '$DATA = request.$W

        ...

        $INTERM = $STR + $DATA

        ...

        open(..., $INTERM, ...)

        '
    - pattern: "$DATA = request.$W\n...\n$INTERM = $STR + $DATA\n...\nwith open(...,\
        \ $INTERM, ...) as $FD:\n  ...\n"
    - pattern: $A = open(..., request.$W, ...)
    - pattern: $A = open(..., $S.format(..., request.$W, ...), ...)
    - pattern: $A = open(..., $S % request.$W, ...)
    - pattern: $A = open(..., f"...{request.$W}...", ...)
    - pattern: return open(..., request.$W, ...)
    - pattern: return open(..., $S.format(..., request.$W, ...), ...)
    - pattern: return open(..., $S % request.$W, ...)
    - pattern: return open(..., f"...{request.$W}...", ...)
    - pattern: "$DATA = request.$W\n...\nwith open(..., $DATA, ...) as $FD:\n  ...\n"
  severity: WARNING
