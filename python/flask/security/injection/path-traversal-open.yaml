rules:
- id: path-traversal-open__daufo
  languages:
  - python
  message: Found request data in a call to 'open'. Ensure the request data is validated
    or sanitized, otherwise it could result in path traversal attacks.
  metadata:
    category: security
    confidence: MEDIUM
    cwe:
    - 'CWE-22: Improper Limitation of a Pathname to a Restricted Directory (''Path
      Traversal'')'
    cwe2021-top25: true
    cwe2022-top25: true
    impact: HIGH
    likelihood: MEDIUM
    owasp:
    - A05:2017 - Broken Access Control
    - A01:2021 - Broken Access Control
    references:
    - https://owasp.org/www-community/attacks/Path_Traversal
    subcategory:
    - audit
    technology:
    - flask
  pattern-either:
  - patterns:
    - pattern: open(...)
    - pattern-either:
      - pattern-inside: "@$APP.route($ROUTE, ...)\ndef $FUNC(..., $ROUTEVAR, ...):\n\
          \  ...\n  open(..., <... $ROUTEVAR ...>, ...)\n"
      - pattern-inside: "@$APP.route($ROUTE, ...)\ndef $FUNC(..., $ROUTEVAR, ...):\n\
          \  ...\n  with open(..., <... $ROUTEVAR ...>, ...) as $FD:\n    ...\n"
      - pattern-inside: "@$APP.route($ROUTE, ...)\ndef $FUNC(..., $ROUTEVAR, ...):\n\
          \  ...\n  $INTERM = <... $ROUTEVAR ...>\n  ...\n  open(..., <... $INTERM\
          \ ...>, ...)\n"
  - pattern: open(..., <... flask.request.$W.get(...) ...>, ...)
  - pattern: open(..., <... flask.request.$W[...] ...>, ...)
  - pattern: open(..., <... flask.request.$W(...) ...>, ...)
  - pattern: open(..., <... flask.request.$W ...>, ...)
  - patterns:
    - pattern-inside: '$INTERM = <... flask.request.$W.get(...) ...>

        ...

        open(<... $INTERM ...>, ...)

        '
    - pattern: open(...)
  - patterns:
    - pattern-inside: '$INTERM = <... flask.request.$W[...] ...>

        ...

        open(<... $INTERM ...>, ...)

        '
    - pattern: open(...)
  - patterns:
    - pattern-inside: '$INTERM = <... flask.request.$W(...) ...>

        ...

        open(<... $INTERM ...>, ...)

        '
    - pattern: open(...)
  - patterns:
    - pattern-inside: '$INTERM = <... flask.request.$W ...>

        ...

        open(<... $INTERM ...>, ...)

        '
    - pattern: open(...)
  - patterns:
    - pattern-inside: "$INTERM = <... flask.request.$W.get(...) ...>\n...\nwith open(<...\
        \ $INTERM ...>, ...) as $F:\n  ...\n"
    - pattern: open(...)
  - patterns:
    - pattern-inside: "$INTERM = <... flask.request.$W[...] ...>\n...\nwith open(<...\
        \ $INTERM ...>, ...) as $F:\n  ...\n"
    - pattern: open(...)
  - patterns:
    - pattern-inside: "$INTERM = <... flask.request.$W(...) ...>\n...\nwith open(<...\
        \ $INTERM ...>, ...) as $F:\n  ...\n"
    - pattern: open(...)
  - patterns:
    - pattern-inside: "$INTERM = <... flask.request.$W ...>\n...\nwith open(<... $INTERM\
        \ ...>, ...) as $F:\n  ...\n"
    - pattern: open(...)
  severity: ERROR
